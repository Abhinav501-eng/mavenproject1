pipeline{
    agent any
        stages{
                stage('scm checkout'){
                    steps{git branch: 'master', url: 'https://github.com/Abhinav501-eng/mavenproject1'}
                }
                stage('code compile'){
                    steps{withMaven(globalMavenSettingsConfig: '', jdk: 'JAVA_HOME', maven: 'MAVEN_HOME', mavenSettingsConfig: '', traceability: true) 
                    {sh 'mvn compile'}
                         }
                }
                stage('execute unit test case '){
                    steps{withMaven(globalMavenSettingsConfig: '', jdk: 'JAVA_HOME', maven: 'MAVEN_HOME', mavenSettingsConfig: '', traceability: true)
                   {sh 'mvn test'}
                         }
                }
        
                stage('code build'){
                    steps{withMaven(globalMavenSettingsConfig: '', jdk: 'JAVA_HOME', maven: 'MAVEN_HOME', mavenSettingsConfig: '', traceability: true)
                   {sh 'mvn package'}
                         }
                }

                stage('deploye tomcat server'){
                    steps{sshagent(credentials: ['deploy-to-tomcat'], ignoreMissing: true) {
                 sh 'scp -o StrictHostkeyChecking=no webapp/target/webapp.war ec2-user@172.31.11.15:/usr/share/tomcat/webapps/'
                 }
                }}

                stage ('deployment to prod manually'){
                input 'Do you approve deployement?'
                   steps{sshagent(credentials: ['deploy-to-tomcat'], ignoreMissing: true) {
                 sh 'scp -o StrictHostkeyChecking=no webapp/target/webapp.war ec2-user@172.31.11.15:/usr/share/tomcat/webapps'
                 }
                }}
        
        }
}
    

